# 自动扩容及数据备份 #

##  自动扩容

### 修改分表规则
* ALTER TABLE SET RULE

	* 语法描述

	```sql
	ALTER TABLE TABLE_NAME SET RULE sharding_options;
	```

	* 语句说明

	sharding_options参考建表语句的的语法。

	* 应用实例
	```sql
	vds>SHOW CREATE TABLE T1;
    +-------+---------------------------------------------------------------------------------------------------------------
    --------------------------+
    | TABLE | CREATE TABLE
                              |
    +-------+---------------------------------------------------------------------------------------------------------------
    --------------------------+
    | T1    | CREATE TABLE S1.T1(\n    A INT NOT NULL,\n    B DATE,\n    C INT\n) ENGINE=VDS SHARDING BY RULE( (DAY( B)%2))S
    EGMENTS ('T1@B1','T1@B2') |
    +-------+---------------------------------------------------------------------------------------------------------------
    --------------------------+
    1 row in set (0.01 sec)
    
    vds>@B1 select * from T1;
    +------+------------+------+
    | A    | B          | C    |
    +------+------------+------+
    |    4 | 2018-09-12 |    4 |
    |    6 | 2016-03-26 |    3 |
    +------+------------+------+
    2 rows in set (0.03 sec)
    
    vds>@B2 select * from T1;
    +------+------------+------+
    | A    | B          | C    |
    +------+------------+------+
    |    0 | 2016-04-11 |    4 |
    +------+------------+------+
    1 row in set (0.02 sec)
    
    vds>alter table t1 set rule SHARDING BY hash month(b)('T1@B1','T1@B2');
    Query OK, 0 rows affected (0.74 sec)
    
    vds>
    vds>SHOW CREATE TABLE T1;
    +-------+---------------------------------------------------------------------------------------------------------------
    -----------------------------+
    | TABLE | CREATE TABLE
                                 |
    +-------+---------------------------------------------------------------------------------------------------------------
    -----------------------------+
    | T1    | CREATE TABLE S1.T1(\n    A INT NOT NULL,\n    B DATE,\n    C INT\n) ENGINE=VDS SHARDING BY RULE( (MONTH(B) % 2
    ))SEGMENTS ('T1@B1','T1@B2') |
    +-------+---------------------------------------------------------------------------------------------------------------
    -----------------------------+
    1 row in set (0.01 sec)
    
    vds>@B1 select * from T1;
    +------+------------+------+
    | A    | B          | C    |
    +------+------------+------+
    |    0 | 2016-04-11 |    4 |
    +------+------------+------+
    1 row in set (0.01 sec)
    
    vds>@B2 select * from T1;
    +------+------------+------+
    | A    | B          | C    |
    +------+------------+------+
    |    4 | 2018-09-12 |    4 |
    |    6 | 2016-03-26 |    3 |
    +------+------------+------+
    2 rows in set (0.02 sec)


	```
	 

##  数据备份支持

### MySqlDump

* MysqlDump

	* 语法描述

	```sql
	mysqldump --backends-B1-B2 [~~~]
	```

	* 语句说明

	在vds内部调用mysqldump，命令在vds中使用而不是外部调用；
	--backends-B1-B2~~~|--backends-all 指定物理库，取代原mysqldump使用的登录信息，
	无此选项时默认--backends-all，指定数据库和表时，使用vds的schema和table。
	其他语法与参考mysqldump。

	* 应用实例
	```sql
	mysqldump --backends-all --skip-compact --default-character-set=utf8 -t --skip-comments --where="(MONTH(B)%2)!=0" S1 T1 > D:/abc.sql;
	```


	